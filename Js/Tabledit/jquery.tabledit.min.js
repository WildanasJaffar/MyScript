/*!
 * Tabledit v1.2.3 (https://github.com/markcell/jQuery-Tabledit)
 * Copyright (c) 2015 Celso Marques
 * Licensed under MIT (https://github.com/markcell/jQuery-Tabledit/blob/master/LICENSE)
 * 
 * Edited Muhammad Wildan Jaffar Rahmatullah
 * Change Class
 * Append some Parameter on edit / delete
 * SWAL Confirm on delete
 * 2 reset button type 
 * Edit with custom input attr
 * onDrawEditCallback // call when edit is on fire
 * Parameter 'data' in function onAjax
 * input attr data-remember
 */
if("undefined"==typeof jQuery)throw new Error("Tabledit requires jQuery library.");!function(t){"use strict";t.fn.Tabledit=function(e){if(!this.is("table"))throw new Error("Tabledit only works when applied to a table.");var n=this,i={url:window.location.href,inputClass:"form-control input-sm",toolbarClass:"btn-toolbar",groupClass:"btn-group btn-group-sm",dangerClass:"danger",warningClass:"warning",mutedClass:"text-muted",eventType:"click",rowIdentifier:"id",hideIdentifier:!1,autoFocus:!0,editButton:!0,resetButton:!0,deleteButton:!0,saveButton:!0,restoreButton:!1,editParams:{},deleteParams:{},customParams:{},column_required:[],buttons:{edit:{class:"btn btn-sm btn-clean btn-icon text-primary",html:'<span class="fas fa-pen"></span>',action:"edit"},reset:{class:"btn btn-sm btn-clean btn-icon text-info",html:'<span class="fas fa-undo"></span>',action:"clear"},delete:{class:"btn btn-sm btn-clean btn-icon text-danger",html:'<span class="far fa-trash-alt"></span>',action:"delete"},save:{class:"btn btn-sm btn-clean btn-icon text-success",html:'<span class="fas fa-check"></span>',action:"save"},restore:{class:"btn btn-sm btn-clean btn-icon text-warning",html:'<span class="fas fa-trash-restore-alt"></span>',action:"restore"},confirm:{class:"btn btn-sm btn-clean btn-icon text-danger",html:"Confirm",type:"swal",title:"Apakah Yakin Ingin Dihapus?",text:"Anda tidak bisa mengembalikan data yang telah dihapus!",confirmButtonText:"Ya, Hapus!",cancelButtonText:"Batal"}},onDrawEditCallback:function(t){},onDraw:function(){},onSuccess:function(){},onFail:function(){},onAlways:function(){},onAjax:function(){}},a=t.extend(!0,i,e),d="undefined",s="undefined",l={identifier_exceptable:function(){a.columns.identifier_exceptable&&n.find("tbody td:nth-child("+(parseInt(a.columns.identifier_exceptable[0])+1)+")").each(function(){var e=a.columns.identifier_exceptable[1];if(t.trim(t(this).text())==t.trim(e))if(a.columns.identifier_exceptable.length>2){var n=a.columns.identifier_exceptable[2],i=t(this).parent("tr").find("td div.custom-tabledit-column div.tabledit-action-button button");for(let e=0;e<i.length;e++)t(i[e]).hasClass("tabledit-edit-button")&&!n.edit?t(i[e]).remove():t(i[e]).hasClass("tabledit-delete-button")&&!n.delete&&t(i[e]).remove()}else 1===t(this).parent("tr").find("td div.custom-tabledit-column").length&&t(this).parent("tr").find("td div.custom-tabledit-column").empty()})},identifier:function(){a.hideIdentifier&&n.find("th.hide-"+a.columns.identifier[1]+":nth-child("+parseInt(a.columns.identifier[0])+"1), tbody td:nth-child("+parseInt(a.columns.identifier[0])+"1)").hide(),n.find("tbody td:nth-child("+(parseInt(a.columns.identifier[0])+1)+")").each(function(){var e='<span class="tabledit-span tabledit-identifier">'+t(this).text()+"</span>",n='<input class="tabledit-input tabledit-identifier" type="hidden" name="'+a.columns.identifier[1]+'" value="'+t(this).text()+'" disabled>';t(this).html(e+n),t(this).parent("tr").attr(a.rowIdentifier,t(this).text())})},editable:function(){for(var e=0;e<a.columns.editable.length;e++){n.find("tbody td:nth-child("+(parseInt(a.columns.editable[e][0])+1)+")").each(function(){var n=t(this).text();a.columns.editable[e][1];a.editButton||t(this).css("cursor","pointer");var i='<span class="tabledit-span">'+n+"</span>",d="";switch(a.columns.editable[e][2]){case"textarea":d='<textarea data-remember="'+n+'" ';var s="";t.each(a.columns.editable[e][3],function(t,e){"class"==t?s=e:d+=t+'="'+e+'" '}),d+='class="tabledit-input '+a.inputClass+" "+s+'" name="'+a.columns.editable[e][1]+'" style="display: none;" disabled>'+n+"</textarea>";break;case"select":d="<select ";var l="";s="";t.each(a.columns.editable[e][3],function(t,e){n===e?(d+='data-remember="'+t+'" ',l+='<option value="'+t+'" selected>'+e+"</option>"):l+='<option value="'+t+'">'+e+"</option>"}),t.each(a.columns.editable[e][4],function(t,e){"class"==t?s=e:d+=t+'="'+e+'" '}),d+='class="tabledit-input '+a.inputClass+" "+s+'" name="'+a.columns.editable[e][1]+'" style="display: none;" disabled>',d+=l,d+="</select>";break;default:var o=a.columns.editable[e][2];o=o||"text";var r="";s="";t.each(a.columns.editable[e][3],function(t,e){"class"==t?s=e:r+=t+'="'+e+'" '}),d='<input  data-remember="'+n+'" class="tabledit-input '+a.inputClass+" "+s+'" type="'+o+'" name="'+a.columns.editable[e][1]+'" value="'+n+'"'+r+' style="display: none;" disabled>'}t(this).html(i+d+"<div></div>"),t(this).addClass("tabledit-view-mode")})}},toolbar:function(){if(a.editButton||a.deleteButton){var t="",e="",i="",d="",s="",l="";0===n.find("th.tabledit-toolbar-column").length&&n.find("tr:first").append('<th class="tabledit-toolbar-column"></th>'),a.editButton&&(t='<button type="button" class="tabledit-edit-button '+a.buttons.edit.class+'" title="Ubah">'+a.buttons.edit.html+"</button>",a.resetButton&&(d='<button type="button" class="tabledit-reset-button '+a.buttons.reset.class+'"  title="Reset" style="display: none; float: none;">'+a.buttons.reset.html+"</button>")),a.deleteButton&&(e='<button type="button" class="tabledit-delete-button '+a.buttons.delete.class+'" title="Hapus">'+a.buttons.delete.html+"</button>","btn"==a.buttons.confirm.type&&(l='<button type="button" class="tabledit-confirm-button '+a.buttons.confirm.class+'" title="Konfirmasi" style="display: none; float: none;">'+a.buttons.confirm.html+"</button>")),a.editButton&&a.saveButton&&(i='<button type="button" class="tabledit-save-button '+a.buttons.save.class+'" title="Simpan" style="display: none; float: none;">'+a.buttons.save.html+"</button>"),a.deleteButton&&a.restoreButton&&(s='<button type="button" class="tabledit-restore-button '+a.buttons.restore.class+'" title="Restore" style="display: none; float: none;">'+a.buttons.restore.html+"</button>");var o='<div class="tabledit-toolbar '+a.toolbarClass+'">\n                                            <div class="'+a.groupClass+' tabledit-action-button">'+t+e+'</div>\n                                            <div class="'+a.groupClass+' ml-2">\n                                                '+d+"\n                                                "+i+"\n                                                "+l+"\n                                                "+s+"\n                                            </div>\n                                        </div>";1===n.find("th.tabledit-toolbar-column").length?n.find("td div.custom-tabledit-column").append('<div class="sub-edit-column text-nowrap text-center">'+o+"</div>"):n.find("tbody>tr").append('<td><div class="custom-tabledit-column"><div class="sub-edit-column" style="white-space: nowrap; width: 1%;">'+o+"</div></div></td>")}}},o=function(e){var n=t(e).parent("tr");t(e).parent("tr").find(".tabledit-input.tabledit-identifier").prop("disabled",!0),t(e).find(".tabledit-input").removeClass("is-invalid").blur().hide().prop("disabled",!0),t(e).find("div").empty(),t(e).find(".tabledit-span").show(),t(e).addClass("tabledit-view-mode").removeClass("tabledit-edit-mode"),a.editButton&&(n.find("button.tabledit-save-button").hide(),n.find("button.tabledit-edit-button").removeClass("active").blur(),a.resetButton&&n.find("button.tabledit-reset-button").hide())},r=function(e,n={}){c.reset(e);var i=t(e).parent("tr");i.find(".tabledit-input.tabledit-identifier").prop("disabled",!1),t(e).find(".tabledit-span").hide();var d=t(e).find(".tabledit-input");if(d.prop("disabled",!1).show(),a.autoFocus&&d.focus(),t(e).addClass("tabledit-edit-mode").removeClass("tabledit-view-mode"),a.editButton&&(i.find("button.tabledit-edit-button").addClass("active"),i.find("button.tabledit-save-button").show(),a.resetButton&&i.find("button.tabledit-reset-button").show(),n[d.attr("name")]=d.val()),!jQuery.isEmptyObject(n))return n},u=function(e){t(e).each(function(){var e=t(this).find(".tabledit-input"),n=t(this).find(".tabledit-span").text();e.is("select")?e.find("option").filter(function(){return t.trim(t(this).text())===n}).attr("selected",!0):e.val(n),o(this)})},b=function(e){!1!==f(a.buttons.edit.action)&&(t(e).each(function(){var e=t(this).find(".tabledit-input");e.is("select")?t(this).find(".tabledit-span").text(e.find("option:selected").text()):t(this).find(".tabledit-span").text(e.val()),o(this)}),d=t(e).parent("tr"))},c={reset:function(t){n.find(".tabledit-confirm-button").hide(),n.find(".tabledit-delete-button").removeClass("active").blur()},submit:function(e){c.reset(e),t(e).parent("tr").find("input.tabledit-identifier").attr("disabled",!1);var n=f(a.buttons.delete.action);t(e).parents("tr").find("input.tabledit-identifier").attr("disabled",!0),!1!==n&&(t(e).parent("tr").addClass("tabledit-deleted-row"),t(e).parent("tr").addClass(a.mutedClass).find(".tabledit-toolbar button:not(.tabledit-restore-button)").attr("disabled",!0),t(e).find(".tabledit-restore-button").show(),s=t(e).parent("tr"))},confirm:function(e){n.find("td.tabledit-edit-mode").each(function(){u(this)}),t(e).find(".tabledit-delete-button").addClass("active"),t(e).find(".tabledit-confirm-button").show()},restore:function(e){t(e).parent("tr").find("input.tabledit-identifier").attr("disabled",!1);var n=f(a.buttons.restore.action);t(e).parents("tr").find("input.tabledit-identifier").attr("disabled",!0),!1!==n&&(t(e).parent("tr").removeClass("tabledit-deleted-row"),t(e).parent("tr").removeClass(a.mutedClass).find(".tabledit-toolbar button").attr("disabled",!1),t(e).find(".tabledit-restore-button").hide(),t(e).parent("tr"))}};function f(e){var i="",l=a.customParams,o=Object.keys(l);for(var r of o){i+=i?"&":"",i+=r+"=",i+=jQuery.isFunction(l[r])?l[r]():l[r]}for(var r of("edit"==e?(l=a.editParams,o=Object.keys(l)):"delete"==e&&(l=a.deleteParams,o=Object.keys(l)),o)){i+=i?"&":"",i+=r+"=",i+=jQuery.isFunction(l[r])?l[r]():l[r]}var u=n.find(".tabledit-input").not('input[name^="temp_"]'),b=t(u).serializeArray(),c=t(u).serialize()+"&action="+e+(i?"&"+i:""),f={},m=!0;if(b.forEach(function(n,i){var d=a.columns.identifier[1];for(let i=0;i<a.column_required.length&&"edit"==e&&m;i++){var s=a.column_required[i];if(t(".tabledit-edit-mode input[name="+n.name+"]").removeClass("is-invalid"),t(".tabledit-edit-mode div").removeClass("invalid-feedback").empty(),n.name!=d&&n.name==s&&!n.value)return m=!1,t(".tabledit-edit-mode input[name="+n.name+"]").addClass("is-invalid"),t(".tabledit-edit-mode div").addClass("invalid-feedback").html("Inputan ini tidak boleh kosong."),!1}if(!m)return!1;f[n.name]=n.value}),!m)return!1;if(!1===a.onAjax(e,c,f))return!1;var p=t.post(a.url,c,function(t,i,s){e===a.buttons.edit.action&&(d.removeClass(a.dangerClass).addClass(a.warningClass),setTimeout(function(){n.find("tr."+a.warningClass).removeClass(a.warningClass)},1400)),a.onSuccess(t,i,s)},"json");return p.fail(function(t,n,i){e===a.buttons.delete.action?(s.removeClass(a.mutedClass).addClass(a.dangerClass),s.find(".tabledit-toolbar button").attr("disabled",!1),s.find(".tabledit-toolbar .tabledit-restore-button").hide()):e===a.buttons.edit.action&&d.addClass(a.dangerClass),a.onFail(t,n,i)}),p.always(function(){a.onAlways()}),p}return l.identifier(),l.editable(),l.toolbar(),l.identifier_exceptable(),a.onDraw(),a.deleteButton&&(n.on("click","button.tabledit-delete-button",function(e){if(!0!==e.handled){e.preventDefault();var i=t(this).hasClass("active"),d=t(this).parents("td");c.reset(d),i||("btn"==a.buttons.confirm.type?c.confirm(d):(n.find("td.tabledit-edit-mode").each(function(){u(this)}),Swal.fire({title:a.buttons.confirm.title,text:a.buttons.confirm.text,icon:"warning",showCancelButton:!0,confirmButtonText:a.buttons.confirm.confirmButtonText,cancelButtonText:a.buttons.confirm.cancelButtonText}).then(function(t){t.value&&c.submit(d)}))),e.handled=!0}}),n.on("click","button.tabledit-confirm-button",function(e){if(!0!==e.handled){e.preventDefault();var n=t(this).parents("td");c.submit(n),e.handled=!0}})),a.restoreButton&&n.on("click","button.tabledit-restore-button",function(e){!0!==e.handled&&(e.preventDefault(),c.restore(t(this).parents("td")),e.handled=!0)}),a.editButton?(n.on("click","button.tabledit-edit-button",function(e){if(!0!==e.handled){e.preventDefault();var i=t(this),d={},s=i.hasClass("active");if(u(n.find("td.tabledit-edit-mode")),!s){t(i.parents("tr").find("td.tabledit-view-mode").get().reverse()).each(function(){d=r(this,d)});var l=t(i.parents("tr").find("td input.tabledit-input.tabledit-identifier"));d[l.attr("name")]=l.val()}a.onDrawEditCallback(s?"view":"edit",d),e.handled=!0}}),n.on("click","button.tabledit-save-button",function(e){!0!==e.handled&&(e.preventDefault(),b(t(this).parents("tr").find("td.tabledit-edit-mode")),e.handled=!0)}),a.resetButton&&n.on("click","button.tabledit-reset-button",function(e){if(!0!==e.handled){e.preventDefault();var n=t(this);t(n.parents("tr").find("td.tabledit-edit-mode").get().reverse()).each(function(e,n){var i=a.buttons.reset.action,d={elem:t(n).find("textarea"),data_remember:t(n).find("textarea").attr("data-remember")},s={elem:t(n).find("input"),data_remember:t(n).find("input").attr("data-remember")},l={elem:t(n).find("select"),data_remember:t(n).find("select").attr("data-remember")};void 0!==d.data_remember&&("reset"==i?d.elem.val(d.data_remember):d.elem.val(""),d.elem.trigger("change")),void 0!==s.data_remember&&(s.elem.hasAttr("readonly")||("reset"==i?s.elem.val(s.data_remember):s.elem.val(""),s.elem.trigger("change"))),void 0!==l.data_remember&&("reset"==i?l.elem.val(l.data_remember):l.elem.val(""),l.elem.trigger("change"))}),e.handled=!0}})):(n.on(a.eventType,"tr:not(.tabledit-deleted-row) td.tabledit-view-mode",function(t){!0!==t.handled&&(t.preventDefault(),u(n.find("td.tabledit-edit-mode")),r(this),t.handled=!0)}),n.on("change","select.tabledit-input:visible",function(){!0!==event.handled&&(b(t(this).parent("td")),event.handled=!0)}),t(document).on("click",function(t){var e=n.find(".tabledit-edit-mode");e.is(t.target)||0!==e.has(t.target).length||u(n.find(".tabledit-input:visible").parent("td"))})),t(document).on("keyup",function(t){var e=n.find(".tabledit-input:visible"),i=n.find(".tabledit-confirm-button");if(e.length>0)var d=e.parents("td");else{if(!(i.length>0))return;d=i.parents("td")}if(!t.shiftKey&&!a.editButton)switch(t.keyCode){case 9:b(d),r(d.closest("td").next());break;case 13:b(d);break;case 27:u(d),c.reset(d)}}),this}}(jQuery);